2025-11-13 21:41:29.569 INFO 35218 [-/127.0.0.1/-/25ms POST /api/v1/agent/run] 查找会话: GUYUTEST1
2025-11-13 21:41:29.615 ERROR 35218 [-/127.0.0.1/-/71ms POST /api/v1/agent/run] 查询会话失败: Unknown column 'AiSessionModel.sessionId' in 'field list' QueryFailedError: Unknown column 'AiSessionModel.sessionId' in 'field list'
    at QueryFailedError.TypeORMError [as constructor] (/Users/guyumac/Documents/my-midway/midway-project/src/error/TypeORMError.ts:7:9)
    at new QueryFailedError (/Users/guyumac/Documents/my-midway/midway-project/src/error/QueryFailedError.ts:9:9)
    at Query.onResult (/Users/guyumac/Documents/my-midway/midway-project/src/driver/mysql/MysqlQueryRunner.ts:196:37)
    at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:36:14)
    at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
    at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
    at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
    at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
    at Socket.emit (node:events:524:28)
    at addChunk (node:internal/streams/readable:561:12) {
  query: 'SELECT `AiSessionModel`.`db_id` AS `AiSessionModel_db_id`, `AiSessionModel`.`id` AS `AiSessionModel_id`, `AiSessionModel`.`status` AS `AiSessionModel_status`, `AiSessionModel`.`version` AS `AiSessionModel_version`, `AiSessionModel`.`create_date` AS `AiSessionModel_create_date`, `AiSessionModel`.`update_date` AS `AiSessionModel_update_date`, `AiSessionModel`.`removed_date` AS `AiSessionModel_removed_date`, `AiSessionModel`.`sessionId` AS `AiSessionModel_sessionId`, `AiSessionModel`.`workerId` AS `AiSessionModel_workerId`, `AiSessionModel`.`businessType` AS `AiSessionModel_businessType`, `AiSessionModel`.`name` AS `AiSessionModel_name`, `AiSessionModel`.`ext` AS `AiSessionModel_ext` FROM `ai_session` `AiSessionModel` WHERE `AiSessionModel`.`id` = ? LIMIT 1',
  parameters: [ 'GUYUTEST1' ],
  driverError: Error: Unknown column 'AiSessionModel.sessionId' in 'field list'
      at Packet.asError (/Users/guyumac/node_modules/mysql2/lib/packets/packet.js:740:17)
      at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:29:26)
      at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
      at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
      at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
      at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Socket.Readable.push (node:internal/streams/readable:392:5) {
    code: 'ER_BAD_FIELD_ERROR',
    errno: 1054,
    sqlState: '42S22',
    sqlMessage: "Unknown column 'AiSessionModel.sessionId' in 'field list'",
    sql: "SELECT `AiSessionModel`.`db_id` AS `AiSessionModel_db_id`, `AiSessionModel`.`id` AS `AiSessionModel_id`, `AiSessionModel`.`status` AS `AiSessionModel_status`, `AiSessionModel`.`version` AS `AiSessionModel_version`, `AiSessionModel`.`create_date` AS `AiSessionModel_create_date`, `AiSessionModel`.`update_date` AS `AiSessionModel_update_date`, `AiSessionModel`.`removed_date` AS `AiSessionModel_removed_date`, `AiSessionModel`.`sessionId` AS `AiSessionModel_sessionId`, `AiSessionModel`.`workerId` AS `AiSessionModel_workerId`, `AiSessionModel`.`businessType` AS `AiSessionModel_businessType`, `AiSessionModel`.`name` AS `AiSessionModel_name`, `AiSessionModel`.`ext` AS `AiSessionModel_ext` FROM `ai_session` `AiSessionModel` WHERE `AiSessionModel`.`id` = 'GUYUTEST1' LIMIT 1"
  },
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sqlState: '42S22',
  sqlMessage: "Unknown column 'AiSessionModel.sessionId' in 'field list'",
  sql: "SELECT `AiSessionModel`.`db_id` AS `AiSessionModel_db_id`, `AiSessionModel`.`id` AS `AiSessionModel_id`, `AiSessionModel`.`status` AS `AiSessionModel_status`, `AiSessionModel`.`version` AS `AiSessionModel_version`, `AiSessionModel`.`create_date` AS `AiSessionModel_create_date`, `AiSessionModel`.`update_date` AS `AiSessionModel_update_date`, `AiSessionModel`.`removed_date` AS `AiSessionModel_removed_date`, `AiSessionModel`.`sessionId` AS `AiSessionModel_sessionId`, `AiSessionModel`.`workerId` AS `AiSessionModel_workerId`, `AiSessionModel`.`businessType` AS `AiSessionModel_businessType`, `AiSessionModel`.`name` AS `AiSessionModel_name`, `AiSessionModel`.`ext` AS `AiSessionModel_ext` FROM `ai_session` `AiSessionModel` WHERE `AiSessionModel`.`id` = 'GUYUTEST1' LIMIT 1"
}
2025-11-13 21:41:29.642 ERROR 35218 [-/127.0.0.1/-/98ms POST /api/v1/agent/run] Agent 运行失败: 查询会话失败: Unknown column 'AiSessionModel.sessionId' in 'field list' Error: 查询会话失败: Unknown column 'AiSessionModel.sessionId' in 'field list'
    at AiSessionService.findById (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AiSessionService.ts:67:19)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at AgentService.run (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AgentService.ts:46:34)
    at AgentController.run (/Users/guyumac/Documents/my-midway/midway-project/src/ApiGateway/aiController/AgentController.ts:36:5)
    at AgentController.Clz.<computed> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/service/aspectService.js:92:34)
    at Object.<anonymous> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/common/webGenerator.js:43:26)
    at CorsMiddleware.compatibleMiddleware (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/cross-domain/dist/middleware/cors.js:33:20)
    at xssProtection (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/xssProtection.js:7:5)
    at nosniff (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/nosniff.js:8:5)
    at noopen (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/noopen.js:8:5)
2025-11-13 21:41:29.648 ERROR 35218 [-/127.0.0.1/-/104ms POST /api/v1/agent/run] Error: Agent 运行失败: 查询会话失败: Unknown column 'AiSessionModel.sessionId' in 'field list'
    at AgentService.run (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AgentService.ts:80:19)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at AgentController.run (/Users/guyumac/Documents/my-midway/midway-project/src/ApiGateway/aiController/AgentController.ts:36:5)
    at AgentController.Clz.<computed> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/service/aspectService.js:92:34)
    at Object.<anonymous> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/common/webGenerator.js:43:26)
    at CorsMiddleware.compatibleMiddleware (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/cross-domain/dist/middleware/cors.js:33:20)
    at xssProtection (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/xssProtection.js:7:5)
    at nosniff (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/nosniff.js:8:5)
    at noopen (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/noopen.js:8:5)
    at session (/Users/guyumac/Documents/my-midway/midway-project/node_modules/koa-session/index.js:41:7) {
  headerSent: true
}
2025-11-13 21:46:25.301 INFO 964 [-/127.0.0.1/-/19ms POST /api/v1/agent/run] 查找会话: GUYUTEST1
2025-11-13 21:46:25.310 ERROR 964 [-/127.0.0.1/-/28ms POST /api/v1/agent/run] 查询会话失败: Unknown column 'AiSessionModel.workerId' in 'field list' QueryFailedError: Unknown column 'AiSessionModel.workerId' in 'field list'
    at QueryFailedError.TypeORMError [as constructor] (/Users/guyumac/Documents/my-midway/midway-project/src/error/TypeORMError.ts:7:9)
    at new QueryFailedError (/Users/guyumac/Documents/my-midway/midway-project/src/error/QueryFailedError.ts:9:9)
    at Query.onResult (/Users/guyumac/Documents/my-midway/midway-project/src/driver/mysql/MysqlQueryRunner.ts:196:37)
    at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:36:14)
    at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
    at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
    at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
    at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
    at Socket.emit (node:events:524:28)
    at addChunk (node:internal/streams/readable:561:12) {
  query: 'SELECT `AiSessionModel`.`db_id` AS `AiSessionModel_db_id`, `AiSessionModel`.`id` AS `AiSessionModel_id`, `AiSessionModel`.`status` AS `AiSessionModel_status`, `AiSessionModel`.`version` AS `AiSessionModel_version`, `AiSessionModel`.`create_date` AS `AiSessionModel_create_date`, `AiSessionModel`.`update_date` AS `AiSessionModel_update_date`, `AiSessionModel`.`removed_date` AS `AiSessionModel_removed_date`, `AiSessionModel`.`workerId` AS `AiSessionModel_workerId`, `AiSessionModel`.`businessType` AS `AiSessionModel_businessType`, `AiSessionModel`.`name` AS `AiSessionModel_name`, `AiSessionModel`.`ext` AS `AiSessionModel_ext` FROM `ai_session` `AiSessionModel` WHERE `AiSessionModel`.`id` = ? LIMIT 1',
  parameters: [ 'GUYUTEST1' ],
  driverError: Error: Unknown column 'AiSessionModel.workerId' in 'field list'
      at Packet.asError (/Users/guyumac/node_modules/mysql2/lib/packets/packet.js:740:17)
      at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:29:26)
      at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
      at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
      at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
      at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Socket.Readable.push (node:internal/streams/readable:392:5) {
    code: 'ER_BAD_FIELD_ERROR',
    errno: 1054,
    sqlState: '42S22',
    sqlMessage: "Unknown column 'AiSessionModel.workerId' in 'field list'",
    sql: "SELECT `AiSessionModel`.`db_id` AS `AiSessionModel_db_id`, `AiSessionModel`.`id` AS `AiSessionModel_id`, `AiSessionModel`.`status` AS `AiSessionModel_status`, `AiSessionModel`.`version` AS `AiSessionModel_version`, `AiSessionModel`.`create_date` AS `AiSessionModel_create_date`, `AiSessionModel`.`update_date` AS `AiSessionModel_update_date`, `AiSessionModel`.`removed_date` AS `AiSessionModel_removed_date`, `AiSessionModel`.`workerId` AS `AiSessionModel_workerId`, `AiSessionModel`.`businessType` AS `AiSessionModel_businessType`, `AiSessionModel`.`name` AS `AiSessionModel_name`, `AiSessionModel`.`ext` AS `AiSessionModel_ext` FROM `ai_session` `AiSessionModel` WHERE `AiSessionModel`.`id` = 'GUYUTEST1' LIMIT 1"
  },
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sqlState: '42S22',
  sqlMessage: "Unknown column 'AiSessionModel.workerId' in 'field list'",
  sql: "SELECT `AiSessionModel`.`db_id` AS `AiSessionModel_db_id`, `AiSessionModel`.`id` AS `AiSessionModel_id`, `AiSessionModel`.`status` AS `AiSessionModel_status`, `AiSessionModel`.`version` AS `AiSessionModel_version`, `AiSessionModel`.`create_date` AS `AiSessionModel_create_date`, `AiSessionModel`.`update_date` AS `AiSessionModel_update_date`, `AiSessionModel`.`removed_date` AS `AiSessionModel_removed_date`, `AiSessionModel`.`workerId` AS `AiSessionModel_workerId`, `AiSessionModel`.`businessType` AS `AiSessionModel_businessType`, `AiSessionModel`.`name` AS `AiSessionModel_name`, `AiSessionModel`.`ext` AS `AiSessionModel_ext` FROM `ai_session` `AiSessionModel` WHERE `AiSessionModel`.`id` = 'GUYUTEST1' LIMIT 1"
}
2025-11-13 21:46:25.334 ERROR 964 [-/127.0.0.1/-/52ms POST /api/v1/agent/run] Agent 运行失败: 查询会话失败: Unknown column 'AiSessionModel.workerId' in 'field list' Error: 查询会话失败: Unknown column 'AiSessionModel.workerId' in 'field list'
    at AiSessionService.findById (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AiSessionService.ts:67:19)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at AgentService.run (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AgentService.ts:46:34)
    at AgentController.run (/Users/guyumac/Documents/my-midway/midway-project/src/ApiGateway/aiController/AgentController.ts:36:5)
    at AgentController.Clz.<computed> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/service/aspectService.js:92:34)
    at Object.<anonymous> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/common/webGenerator.js:43:26)
    at CorsMiddleware.compatibleMiddleware (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/cross-domain/dist/middleware/cors.js:33:20)
    at xssProtection (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/xssProtection.js:7:5)
    at nosniff (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/nosniff.js:8:5)
    at noopen (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/noopen.js:8:5)
2025-11-13 21:46:25.338 ERROR 964 [-/127.0.0.1/-/56ms POST /api/v1/agent/run] Error: Agent 运行失败: 查询会话失败: Unknown column 'AiSessionModel.workerId' in 'field list'
    at AgentService.run (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AgentService.ts:80:19)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at AgentController.run (/Users/guyumac/Documents/my-midway/midway-project/src/ApiGateway/aiController/AgentController.ts:36:5)
    at AgentController.Clz.<computed> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/service/aspectService.js:92:34)
    at Object.<anonymous> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/common/webGenerator.js:43:26)
    at CorsMiddleware.compatibleMiddleware (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/cross-domain/dist/middleware/cors.js:33:20)
    at xssProtection (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/xssProtection.js:7:5)
    at nosniff (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/nosniff.js:8:5)
    at noopen (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/noopen.js:8:5)
    at session (/Users/guyumac/Documents/my-midway/midway-project/node_modules/koa-session/index.js:41:7) {
  headerSent: true
}
2025-11-13 21:49:06.666 INFO 3357 [-/127.0.0.1/-/22ms POST /api/v1/agent/run] 查找会话: guyutest1
2025-11-13 21:49:06.676 ERROR 3357 [-/127.0.0.1/-/32ms POST /api/v1/agent/run] 查询会话失败: Unknown column 'AiSessionModel.workerId' in 'field list' QueryFailedError: Unknown column 'AiSessionModel.workerId' in 'field list'
    at QueryFailedError.TypeORMError [as constructor] (/Users/guyumac/Documents/my-midway/midway-project/src/error/TypeORMError.ts:7:9)
    at new QueryFailedError (/Users/guyumac/Documents/my-midway/midway-project/src/error/QueryFailedError.ts:9:9)
    at Query.onResult (/Users/guyumac/Documents/my-midway/midway-project/src/driver/mysql/MysqlQueryRunner.ts:196:37)
    at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:36:14)
    at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
    at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
    at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
    at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
    at Socket.emit (node:events:524:28)
    at addChunk (node:internal/streams/readable:561:12) {
  query: 'SELECT `AiSessionModel`.`db_id` AS `AiSessionModel_db_id`, `AiSessionModel`.`id` AS `AiSessionModel_id`, `AiSessionModel`.`status` AS `AiSessionModel_status`, `AiSessionModel`.`version` AS `AiSessionModel_version`, `AiSessionModel`.`create_date` AS `AiSessionModel_create_date`, `AiSessionModel`.`update_date` AS `AiSessionModel_update_date`, `AiSessionModel`.`removed_date` AS `AiSessionModel_removed_date`, `AiSessionModel`.`workerId` AS `AiSessionModel_workerId`, `AiSessionModel`.`businessType` AS `AiSessionModel_businessType`, `AiSessionModel`.`name` AS `AiSessionModel_name`, `AiSessionModel`.`ext` AS `AiSessionModel_ext` FROM `ai_session` `AiSessionModel` WHERE `AiSessionModel`.`id` = ? LIMIT 1',
  parameters: [ 'guyutest1' ],
  driverError: Error: Unknown column 'AiSessionModel.workerId' in 'field list'
      at Packet.asError (/Users/guyumac/node_modules/mysql2/lib/packets/packet.js:740:17)
      at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:29:26)
      at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
      at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
      at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
      at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Socket.Readable.push (node:internal/streams/readable:392:5) {
    code: 'ER_BAD_FIELD_ERROR',
    errno: 1054,
    sqlState: '42S22',
    sqlMessage: "Unknown column 'AiSessionModel.workerId' in 'field list'",
    sql: "SELECT `AiSessionModel`.`db_id` AS `AiSessionModel_db_id`, `AiSessionModel`.`id` AS `AiSessionModel_id`, `AiSessionModel`.`status` AS `AiSessionModel_status`, `AiSessionModel`.`version` AS `AiSessionModel_version`, `AiSessionModel`.`create_date` AS `AiSessionModel_create_date`, `AiSessionModel`.`update_date` AS `AiSessionModel_update_date`, `AiSessionModel`.`removed_date` AS `AiSessionModel_removed_date`, `AiSessionModel`.`workerId` AS `AiSessionModel_workerId`, `AiSessionModel`.`businessType` AS `AiSessionModel_businessType`, `AiSessionModel`.`name` AS `AiSessionModel_name`, `AiSessionModel`.`ext` AS `AiSessionModel_ext` FROM `ai_session` `AiSessionModel` WHERE `AiSessionModel`.`id` = 'guyutest1' LIMIT 1"
  },
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sqlState: '42S22',
  sqlMessage: "Unknown column 'AiSessionModel.workerId' in 'field list'",
  sql: "SELECT `AiSessionModel`.`db_id` AS `AiSessionModel_db_id`, `AiSessionModel`.`id` AS `AiSessionModel_id`, `AiSessionModel`.`status` AS `AiSessionModel_status`, `AiSessionModel`.`version` AS `AiSessionModel_version`, `AiSessionModel`.`create_date` AS `AiSessionModel_create_date`, `AiSessionModel`.`update_date` AS `AiSessionModel_update_date`, `AiSessionModel`.`removed_date` AS `AiSessionModel_removed_date`, `AiSessionModel`.`workerId` AS `AiSessionModel_workerId`, `AiSessionModel`.`businessType` AS `AiSessionModel_businessType`, `AiSessionModel`.`name` AS `AiSessionModel_name`, `AiSessionModel`.`ext` AS `AiSessionModel_ext` FROM `ai_session` `AiSessionModel` WHERE `AiSessionModel`.`id` = 'guyutest1' LIMIT 1"
}
2025-11-13 21:49:06.710 ERROR 3357 [-/127.0.0.1/-/66ms POST /api/v1/agent/run] Agent 运行失败: 查询会话失败: Unknown column 'AiSessionModel.workerId' in 'field list' Error: 查询会话失败: Unknown column 'AiSessionModel.workerId' in 'field list'
    at AiSessionService.findById (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AiSessionService.ts:67:19)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at AgentService.run (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AgentService.ts:46:34)
    at AgentController.run (/Users/guyumac/Documents/my-midway/midway-project/src/ApiGateway/aiController/AgentController.ts:36:5)
    at AgentController.Clz.<computed> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/service/aspectService.js:92:34)
    at Object.<anonymous> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/common/webGenerator.js:43:26)
    at CorsMiddleware.compatibleMiddleware (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/cross-domain/dist/middleware/cors.js:94:20)
    at xssProtection (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/xssProtection.js:7:5)
    at nosniff (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/nosniff.js:8:5)
    at noopen (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/noopen.js:8:5)
2025-11-13 21:49:06.715 ERROR 3357 [-/127.0.0.1/-/71ms POST /api/v1/agent/run] Error: Agent 运行失败: 查询会话失败: Unknown column 'AiSessionModel.workerId' in 'field list'
    at AgentService.run (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AgentService.ts:80:19)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at AgentController.run (/Users/guyumac/Documents/my-midway/midway-project/src/ApiGateway/aiController/AgentController.ts:36:5)
    at AgentController.Clz.<computed> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/service/aspectService.js:92:34)
    at Object.<anonymous> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/common/webGenerator.js:43:26)
    at CorsMiddleware.compatibleMiddleware (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/cross-domain/dist/middleware/cors.js:94:20)
    at xssProtection (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/xssProtection.js:7:5)
    at nosniff (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/nosniff.js:8:5)
    at noopen (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/noopen.js:8:5)
    at session (/Users/guyumac/Documents/my-midway/midway-project/node_modules/koa-session/index.js:41:7) {
  headerSent: true
}
2025-11-13 21:50:08.933 INFO 3357 [-/127.0.0.1/-/7ms POST /api/v1/agent/run] 查找会话: guyutest1
2025-11-13 21:50:08.938 ERROR 3357 [-/127.0.0.1/-/13ms POST /api/v1/agent/run] 查询会话失败: Unknown column 'AiSessionModel.workerId' in 'field list' QueryFailedError: Unknown column 'AiSessionModel.workerId' in 'field list'
    at QueryFailedError.TypeORMError [as constructor] (/Users/guyumac/Documents/my-midway/midway-project/src/error/TypeORMError.ts:7:9)
    at new QueryFailedError (/Users/guyumac/Documents/my-midway/midway-project/src/error/QueryFailedError.ts:9:9)
    at Query.onResult (/Users/guyumac/Documents/my-midway/midway-project/src/driver/mysql/MysqlQueryRunner.ts:196:37)
    at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:36:14)
    at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
    at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
    at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
    at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
    at Socket.emit (node:events:524:28)
    at addChunk (node:internal/streams/readable:561:12) {
  query: 'SELECT `AiSessionModel`.`db_id` AS `AiSessionModel_db_id`, `AiSessionModel`.`id` AS `AiSessionModel_id`, `AiSessionModel`.`status` AS `AiSessionModel_status`, `AiSessionModel`.`version` AS `AiSessionModel_version`, `AiSessionModel`.`create_date` AS `AiSessionModel_create_date`, `AiSessionModel`.`update_date` AS `AiSessionModel_update_date`, `AiSessionModel`.`removed_date` AS `AiSessionModel_removed_date`, `AiSessionModel`.`workerId` AS `AiSessionModel_workerId`, `AiSessionModel`.`businessType` AS `AiSessionModel_businessType`, `AiSessionModel`.`name` AS `AiSessionModel_name`, `AiSessionModel`.`ext` AS `AiSessionModel_ext` FROM `ai_session` `AiSessionModel` WHERE `AiSessionModel`.`id` = ? LIMIT 1',
  parameters: [ 'guyutest1' ],
  driverError: Error: Unknown column 'AiSessionModel.workerId' in 'field list'
      at Packet.asError (/Users/guyumac/node_modules/mysql2/lib/packets/packet.js:740:17)
      at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:29:26)
      at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
      at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
      at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
      at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Socket.Readable.push (node:internal/streams/readable:392:5) {
    code: 'ER_BAD_FIELD_ERROR',
    errno: 1054,
    sqlState: '42S22',
    sqlMessage: "Unknown column 'AiSessionModel.workerId' in 'field list'",
    sql: "SELECT `AiSessionModel`.`db_id` AS `AiSessionModel_db_id`, `AiSessionModel`.`id` AS `AiSessionModel_id`, `AiSessionModel`.`status` AS `AiSessionModel_status`, `AiSessionModel`.`version` AS `AiSessionModel_version`, `AiSessionModel`.`create_date` AS `AiSessionModel_create_date`, `AiSessionModel`.`update_date` AS `AiSessionModel_update_date`, `AiSessionModel`.`removed_date` AS `AiSessionModel_removed_date`, `AiSessionModel`.`workerId` AS `AiSessionModel_workerId`, `AiSessionModel`.`businessType` AS `AiSessionModel_businessType`, `AiSessionModel`.`name` AS `AiSessionModel_name`, `AiSessionModel`.`ext` AS `AiSessionModel_ext` FROM `ai_session` `AiSessionModel` WHERE `AiSessionModel`.`id` = 'guyutest1' LIMIT 1"
  },
  code: 'ER_BAD_FIELD_ERROR',
  errno: 1054,
  sqlState: '42S22',
  sqlMessage: "Unknown column 'AiSessionModel.workerId' in 'field list'",
  sql: "SELECT `AiSessionModel`.`db_id` AS `AiSessionModel_db_id`, `AiSessionModel`.`id` AS `AiSessionModel_id`, `AiSessionModel`.`status` AS `AiSessionModel_status`, `AiSessionModel`.`version` AS `AiSessionModel_version`, `AiSessionModel`.`create_date` AS `AiSessionModel_create_date`, `AiSessionModel`.`update_date` AS `AiSessionModel_update_date`, `AiSessionModel`.`removed_date` AS `AiSessionModel_removed_date`, `AiSessionModel`.`workerId` AS `AiSessionModel_workerId`, `AiSessionModel`.`businessType` AS `AiSessionModel_businessType`, `AiSessionModel`.`name` AS `AiSessionModel_name`, `AiSessionModel`.`ext` AS `AiSessionModel_ext` FROM `ai_session` `AiSessionModel` WHERE `AiSessionModel`.`id` = 'guyutest1' LIMIT 1"
}
2025-11-13 21:50:08.941 ERROR 3357 [-/127.0.0.1/-/16ms POST /api/v1/agent/run] Agent 运行失败: 查询会话失败: Unknown column 'AiSessionModel.workerId' in 'field list' Error: 查询会话失败: Unknown column 'AiSessionModel.workerId' in 'field list'
    at AiSessionService.findById (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AiSessionService.ts:67:19)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at AgentService.run (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AgentService.ts:46:34)
    at AgentController.run (/Users/guyumac/Documents/my-midway/midway-project/src/ApiGateway/aiController/AgentController.ts:36:5)
    at AgentController.Clz.<computed> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/service/aspectService.js:92:34)
    at Object.<anonymous> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/common/webGenerator.js:43:26)
    at CorsMiddleware.compatibleMiddleware (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/cross-domain/dist/middleware/cors.js:94:20)
    at xssProtection (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/xssProtection.js:7:5)
    at nosniff (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/nosniff.js:8:5)
    at noopen (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/noopen.js:8:5)
2025-11-13 21:50:08.944 ERROR 3357 [-/127.0.0.1/-/19ms POST /api/v1/agent/run] Error: Agent 运行失败: 查询会话失败: Unknown column 'AiSessionModel.workerId' in 'field list'
    at AgentService.run (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AgentService.ts:80:19)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at AgentController.run (/Users/guyumac/Documents/my-midway/midway-project/src/ApiGateway/aiController/AgentController.ts:36:5)
    at AgentController.Clz.<computed> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/service/aspectService.js:92:34)
    at Object.<anonymous> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/common/webGenerator.js:43:26)
    at CorsMiddleware.compatibleMiddleware (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/cross-domain/dist/middleware/cors.js:94:20)
    at xssProtection (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/xssProtection.js:7:5)
    at nosniff (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/nosniff.js:8:5)
    at noopen (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/noopen.js:8:5)
    at session (/Users/guyumac/Documents/my-midway/midway-project/node_modules/koa-session/index.js:41:7) {
  headerSent: true
}
2025-11-13 21:53:47.288 INFO 8288 [-/127.0.0.1/-/15ms POST /api/v1/agent/run] 查找会话: guyutest1
2025-11-13 21:53:47.304 WARN 8288 [-/127.0.0.1/-/31ms POST /api/v1/agent/run] 未找到 ID 为 guyutest1 的会话
2025-11-13 21:53:47.304 WARN 8288 [-/127.0.0.1/-/31ms POST /api/v1/agent/run] 未找到会话 guyutest1，将创建新会话
2025-11-13 21:53:47.304 INFO 8288 [-/127.0.0.1/-/31ms POST /api/v1/agent/run] 创建新会话，workerId: guyutest
2025-11-13 21:53:47.330 INFO 8288 [-/127.0.0.1/-/57ms POST /api/v1/agent/run] 创建会话成功: guyutest1
2025-11-13 21:53:47.330 INFO 8288 [-/127.0.0.1/-/57ms POST /api/v1/agent/run] 创建会话成功: guyutest1
2025-11-13 21:53:47.330 INFO 8288 [-/127.0.0.1/-/57ms POST /api/v1/agent/run] 会话模式 - 是否有历史: false, 是否首轮: true
2025-11-13 21:53:47.330 INFO 8288 [-/127.0.0.1/-/57ms POST /api/v1/agent/run] 问题数量: 3
2025-11-13 21:55:47.827 INFO 8288 [-/127.0.0.1/-/9ms POST /api/v1/agent/run] 查找会话: guyutest1
2025-11-13 21:55:47.835 INFO 8288 [-/127.0.0.1/-/17ms POST /api/v1/agent/run] 查询会话成功: guyutest1
2025-11-13 21:55:47.835 INFO 8288 [-/127.0.0.1/-/17ms POST /api/v1/agent/run] 找到历史会话: guyutest1
2025-11-13 21:55:47.835 INFO 8288 [-/127.0.0.1/-/17ms POST /api/v1/agent/run] 会话模式 - 是否有历史: true, 是否首轮: false
2025-11-13 21:55:47.835 INFO 8288 [-/127.0.0.1/-/17ms POST /api/v1/agent/run] 问题数量: 5
2025-11-13 21:55:47.840 INFO 8288 [-/127.0.0.1/-/22ms POST /api/v1/agent/run] 查询 sessionId 为 guyutest1 的消息，共 0 条
2025-11-13 22:11:47.215 INFO 25103 [-/127.0.0.1/-/24ms POST /api/v1/agent/run] 查找会话: guyutest1
2025-11-13 22:11:47.233 WARN 25103 [-/127.0.0.1/-/42ms POST /api/v1/agent/run] 未找到 ID 为 guyutest1 的会话
2025-11-13 22:11:47.233 WARN 25103 [-/127.0.0.1/-/42ms POST /api/v1/agent/run] 未找到会话 guyutest1，将创建新会话
2025-11-13 22:11:47.233 INFO 25103 [-/127.0.0.1/-/42ms POST /api/v1/agent/run] 创建新会话，workerId: guyutest
2025-11-13 22:11:47.251 INFO 25103 [-/127.0.0.1/-/60ms POST /api/v1/agent/run] 创建会话成功: guyutest1
2025-11-13 22:11:47.251 INFO 25103 [-/127.0.0.1/-/60ms POST /api/v1/agent/run] 创建会话成功: guyutest1
2025-11-13 22:11:47.251 INFO 25103 [-/127.0.0.1/-/60ms POST /api/v1/agent/run] 会话模式 - 是否有历史: false, 是否首轮: true
2025-11-13 22:11:47.251 INFO 25103 [-/127.0.0.1/-/60ms POST /api/v1/agent/run] 问题数量: 5
2025-11-13 22:11:47.251 INFO 25103 [-/127.0.0.1/-/60ms POST /api/v1/agent/run] 开始调用AI服务, model: claude_sonnet4, messages: [{"role":"system","content":"you are GUYUAI , a highly skilled software engineer "},{"role":"user","content":"你现在是谁"}]
2025-11-13 22:11:47.261 WARN 25103 [-/127.0.0.1/-/1ms POST /] NotFoundError: / Not Found
    at midwayRouterNotFound (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/web/dist/framework/web.js:80:23)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at CorsMiddleware.compatibleMiddleware (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/cross-domain/dist/middleware/cors.js:33:20)
    at xssProtection (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/xssProtection.js:7:5)
    at nosniff (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/nosniff.js:8:5)
    at noopen (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/noopen.js:8:5)
    at session (/Users/guyumac/Documents/my-midway/midway-project/node_modules/koa-session/index.js:41:7)
    at bodyParser (/Users/guyumac/Documents/my-midway/midway-project/node_modules/koa-bodyparser/index.js:78:5)
    at bodyPatch (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/web/app.js:66:7)
    at notfound (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg/app/middleware/notfound.js:5:5) {
  code: '404',
  cause: undefined,
  status: 404
}
2025-11-13 22:11:47.299 ERROR 25103 [-/127.0.0.1/-/108ms POST /api/v1/agent/run] Error: 大模型流式调用失败
    at AiChatService.aiChatWithStream (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AiChatService.ts:59:19)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at AgentService.run (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AgentService.ts:121:9)
    at AgentController.run (/Users/guyumac/Documents/my-midway/midway-project/src/ApiGateway/aiController/AgentController.ts:36:5)
    at AgentController.Clz.<computed> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/service/aspectService.js:92:34)
    at Object.<anonymous> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/common/webGenerator.js:43:26)
    at CorsMiddleware.compatibleMiddleware (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/cross-domain/dist/middleware/cors.js:94:20)
    at xssProtection (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/xssProtection.js:7:5)
    at nosniff (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/nosniff.js:8:5)
    at noopen (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/noopen.js:8:5) {
  headerSent: true
}
2025-11-13 22:11:47.302 ERROR 25103 [-/127.0.0.1/-/111ms POST /api/v1/agent/run] 创建消息失败: Field 'db_id' doesn't have a default value QueryFailedError: Field 'db_id' doesn't have a default value
    at QueryFailedError.TypeORMError [as constructor] (/Users/guyumac/Documents/my-midway/midway-project/src/error/TypeORMError.ts:7:9)
    at new QueryFailedError (/Users/guyumac/Documents/my-midway/midway-project/src/error/QueryFailedError.ts:9:9)
    at Query.onResult (/Users/guyumac/Documents/my-midway/midway-project/src/driver/mysql/MysqlQueryRunner.ts:196:37)
    at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:36:14)
    at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
    at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
    at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
    at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
    at Socket.emit (node:events:524:28)
    at addChunk (node:internal/streams/readable:561:12) {
  query: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, ?, ?, 1, ?, DEFAULT, ?, ?, ?, ?, ?, DEFAULT, ?)',
  parameters: [
    '11F0C09AB0D1A0308B11C99898DC3C2F',
    'Active',
    2025-11-13T14:11:47.251Z,
    null,
    'guyutest1',
    'UserInput',
    '[{"role":"system","content":"you are GUYUAI , a highly skilled software engineer "},{"role":"user","content":"你现在是谁"}]',
    'guyu',
    '{}'
  ],
  driverError: Error: Field 'db_id' doesn't have a default value
      at Packet.asError (/Users/guyumac/node_modules/mysql2/lib/packets/packet.js:740:17)
      at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:29:26)
      at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
      at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
      at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
      at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Socket.Readable.push (node:internal/streams/readable:392:5) {
    code: 'ER_NO_DEFAULT_FOR_FIELD',
    errno: 1364,
    sqlState: 'HY000',
    sqlMessage: "Field 'db_id' doesn't have a default value",
    sql: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, \'11F0C09AB0D1A0308B11C99898DC3C2F\', \'Active\', 1, \'2025-11-13 22:11:47.251\', DEFAULT, NULL, \'guyutest1\', \'UserInput\', \'[{\\"role\\":\\"system\\",\\"content\\":\\"you are GUYUAI , a highly skilled software engineer \\"},{\\"role\\":\\"user\\",\\"content\\":\\"你现在是谁\\"}]\', \'guyu\', DEFAULT, \'{}\')'
  },
  code: 'ER_NO_DEFAULT_FOR_FIELD',
  errno: 1364,
  sqlState: 'HY000',
  sqlMessage: "Field 'db_id' doesn't have a default value",
  sql: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, \'11F0C09AB0D1A0308B11C99898DC3C2F\', \'Active\', 1, \'2025-11-13 22:11:47.251\', DEFAULT, NULL, \'guyutest1\', \'UserInput\', \'[{\\"role\\":\\"system\\",\\"content\\":\\"you are GUYUAI , a highly skilled software engineer \\"},{\\"role\\":\\"user\\",\\"content\\":\\"你现在是谁\\"}]\', \'guyu\', DEFAULT, \'{}\')'
}
2025-11-13 22:17:04.342 WARN 30460 [-/127.0.0.1/-/37ms POST /api/v1/agent/run] SyntaxError: Expected ',' or '}' after property value in JSON at position 76, check bodyParser config
    at JSON.parse (<anonymous>)
    at Object.exports.parse (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@hapi/bourne/lib/index.js:19:22)
    at parse (/Users/guyumac/Documents/my-midway/midway-project/node_modules/co-body/lib/json.js:59:19)
    at AsyncFunction.module.exports [as json] (/Users/guyumac/Documents/my-midway/midway-project/node_modules/co-body/lib/json.js:43:20)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at parseBody (/Users/guyumac/Documents/my-midway/midway-project/node_modules/koa-bodyparser/index.js:87:14)
    at bodyParser (/Users/guyumac/Documents/my-midway/midway-project/node_modules/koa-bodyparser/index.js:67:19)
    at bodyPatch (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/web/app.js:66:7)
    at notfound (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg/app/middleware/notfound.js:5:5)
    at meta (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg/app/middleware/meta.js:18:5) {
  status: 400,
  body: '{\n' +
    '  "sessionId": "guyutest1",\n' +
    '  "workerId": "guyu",\n' +
    '  "question": "你现在是谁"\n' +
    '  "variableMaps":"{}"\n' +
    '}'
}
2025-11-13 22:17:25.896 INFO 30460 [-/127.0.0.1/-/15ms POST /api/v1/agent/run] 查找会话: guyutest1
2025-11-13 22:17:25.926 WARN 30460 [-/127.0.0.1/-/45ms POST /api/v1/agent/run] 未找到 ID 为 guyutest1 的会话
2025-11-13 22:17:25.926 WARN 30460 [-/127.0.0.1/-/45ms POST /api/v1/agent/run] 未找到会话 guyutest1，将创建新会话
2025-11-13 22:17:25.926 INFO 30460 [-/127.0.0.1/-/45ms POST /api/v1/agent/run] 创建新会话，workerId: guyu
2025-11-13 22:17:25.943 INFO 30460 [-/127.0.0.1/-/62ms POST /api/v1/agent/run] 创建会话成功: guyutest1
2025-11-13 22:17:25.944 INFO 30460 [-/127.0.0.1/-/63ms POST /api/v1/agent/run] 创建会话成功: guyutest1
2025-11-13 22:17:25.944 INFO 30460 [-/127.0.0.1/-/63ms POST /api/v1/agent/run] 会话模式 - 是否有历史: false, 是否首轮: true
2025-11-13 22:17:25.944 INFO 30460 [-/127.0.0.1/-/63ms POST /api/v1/agent/run] 问题数量: 5
2025-11-13 22:17:25.945 ERROR 30460 [-/127.0.0.1/-/64ms POST /api/v1/agent/run] TypeError: Cannot read properties of undefined (reading 'llmConfig')
    at AgentService.run (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AgentService.ts:114:41)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at AgentController.run (/Users/guyumac/Documents/my-midway/midway-project/src/ApiGateway/aiController/AgentController.ts:36:5)
    at AgentController.Clz.<computed> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/service/aspectService.js:92:34)
    at Object.<anonymous> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/common/webGenerator.js:43:26)
    at CorsMiddleware.compatibleMiddleware (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/cross-domain/dist/middleware/cors.js:94:20)
    at xssProtection (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/xssProtection.js:7:5)
    at nosniff (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/nosniff.js:8:5)
    at noopen (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/noopen.js:8:5)
    at session (/Users/guyumac/Documents/my-midway/midway-project/node_modules/koa-session/index.js:41:7) {
  headerSent: true
}
2025-11-13 22:18:04.191 INFO 30460 [-/127.0.0.1/-/5ms POST /api/v1/agent/run] 查找会话: guyutest
2025-11-13 22:18:04.196 WARN 30460 [-/127.0.0.1/-/10ms POST /api/v1/agent/run] 未找到 ID 为 guyutest 的会话
2025-11-13 22:18:04.196 WARN 30460 [-/127.0.0.1/-/10ms POST /api/v1/agent/run] 未找到会话 guyutest，将创建新会话
2025-11-13 22:18:04.196 INFO 30460 [-/127.0.0.1/-/10ms POST /api/v1/agent/run] 创建新会话，workerId: guyu
2025-11-13 22:18:04.201 INFO 30460 [-/127.0.0.1/-/15ms POST /api/v1/agent/run] 创建会话成功: guyutest
2025-11-13 22:18:04.201 INFO 30460 [-/127.0.0.1/-/15ms POST /api/v1/agent/run] 创建会话成功: guyutest
2025-11-13 22:18:04.201 INFO 30460 [-/127.0.0.1/-/15ms POST /api/v1/agent/run] 会话模式 - 是否有历史: false, 是否首轮: true
2025-11-13 22:18:04.201 INFO 30460 [-/127.0.0.1/-/15ms POST /api/v1/agent/run] 问题数量: 3
2025-11-13 22:18:04.202 INFO 30460 [-/127.0.0.1/-/16ms POST /api/v1/agent/run] 开始调用AI服务, model: claude_sonnet4, messages: [{"role":"system","content":"you are GUYUAI , a highly skilled software engineer "},{"role":"user","content":"你是谁"}]
2025-11-13 22:18:04.235 ERROR 30460 [-/127.0.0.1/-/49ms POST /api/v1/agent/run] 创建消息失败: Field 'db_id' doesn't have a default value QueryFailedError: Field 'db_id' doesn't have a default value
    at QueryFailedError.TypeORMError [as constructor] (/Users/guyumac/Documents/my-midway/midway-project/src/error/TypeORMError.ts:7:9)
    at new QueryFailedError (/Users/guyumac/Documents/my-midway/midway-project/src/error/QueryFailedError.ts:9:9)
    at Query.onResult (/Users/guyumac/Documents/my-midway/midway-project/src/driver/mysql/MysqlQueryRunner.ts:196:37)
    at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:36:14)
    at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
    at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
    at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
    at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
    at Socket.emit (node:events:524:28)
    at addChunk (node:internal/streams/readable:561:12) {
  query: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, ?, ?, 1, ?, DEFAULT, ?, ?, ?, ?, ?, DEFAULT, ?)',
  parameters: [
    '11F0C09B917FC8A086CBAB3919DB6483',
    'Active',
    2025-11-13T14:18:04.202Z,
    null,
    'guyutest',
    'UserInput',
    '[{"role":"system","content":"you are GUYUAI , a highly skilled software engineer "},{"role":"user","content":"你是谁"}]',
    'guyu',
    '{}'
  ],
  driverError: Error: Field 'db_id' doesn't have a default value
      at Packet.asError (/Users/guyumac/node_modules/mysql2/lib/packets/packet.js:740:17)
      at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:29:26)
      at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
      at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
      at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
      at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Socket.Readable.push (node:internal/streams/readable:392:5) {
    code: 'ER_NO_DEFAULT_FOR_FIELD',
    errno: 1364,
    sqlState: 'HY000',
    sqlMessage: "Field 'db_id' doesn't have a default value",
    sql: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, \'11F0C09B917FC8A086CBAB3919DB6483\', \'Active\', 1, \'2025-11-13 22:18:04.202\', DEFAULT, NULL, \'guyutest\', \'UserInput\', \'[{\\"role\\":\\"system\\",\\"content\\":\\"you are GUYUAI , a highly skilled software engineer \\"},{\\"role\\":\\"user\\",\\"content\\":\\"你是谁\\"}]\', \'guyu\', DEFAULT, \'{}\')'
  },
  code: 'ER_NO_DEFAULT_FOR_FIELD',
  errno: 1364,
  sqlState: 'HY000',
  sqlMessage: "Field 'db_id' doesn't have a default value",
  sql: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, \'11F0C09B917FC8A086CBAB3919DB6483\', \'Active\', 1, \'2025-11-13 22:18:04.202\', DEFAULT, NULL, \'guyutest\', \'UserInput\', \'[{\\"role\\":\\"system\\",\\"content\\":\\"you are GUYUAI , a highly skilled software engineer \\"},{\\"role\\":\\"user\\",\\"content\\":\\"你是谁\\"}]\', \'guyu\', DEFAULT, \'{}\')'
}
2025-11-13 22:18:04.430 ERROR 30460 [-/127.0.0.1/-/244ms POST /api/v1/agent/run] Error: 大模型流式调用失败
    at AiChatService.aiChatWithStream (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AiChatService.ts:59:19)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at AgentService.run (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AgentService.ts:121:9)
    at AgentController.run (/Users/guyumac/Documents/my-midway/midway-project/src/ApiGateway/aiController/AgentController.ts:36:5)
    at AgentController.Clz.<computed> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/service/aspectService.js:92:34)
    at Object.<anonymous> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/common/webGenerator.js:43:26)
    at CorsMiddleware.compatibleMiddleware (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/cross-domain/dist/middleware/cors.js:94:20)
    at xssProtection (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/xssProtection.js:7:5)
    at nosniff (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/nosniff.js:8:5)
    at noopen (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/noopen.js:8:5) {
  headerSent: true
}
2025-11-13 22:20:16.082 INFO 35324 [-/127.0.0.1/-/19ms POST /api/v1/agent/run] 查找会话: 11
2025-11-13 22:20:16.094 WARN 35324 [-/127.0.0.1/-/31ms POST /api/v1/agent/run] 未找到 ID 为 11 的会话
2025-11-13 22:20:16.095 WARN 35324 [-/127.0.0.1/-/32ms POST /api/v1/agent/run] 未找到会话 11，将创建新会话
2025-11-13 22:20:16.095 INFO 35324 [-/127.0.0.1/-/32ms POST /api/v1/agent/run] 创建新会话，workerId: guyu
2025-11-13 22:20:16.105 INFO 35324 [-/127.0.0.1/-/42ms POST /api/v1/agent/run] 创建会话成功: 11
2025-11-13 22:20:16.105 INFO 35324 [-/127.0.0.1/-/42ms POST /api/v1/agent/run] 创建会话成功: 11
2025-11-13 22:20:16.105 INFO 35324 [-/127.0.0.1/-/42ms POST /api/v1/agent/run] 会话模式 - 是否有历史: false, 是否首轮: true
2025-11-13 22:20:16.105 INFO 35324 [-/127.0.0.1/-/42ms POST /api/v1/agent/run] 问题数量: 11
2025-11-13 22:20:16.106 INFO 35324 [-/127.0.0.1/-/43ms POST /api/v1/agent/run] 开始调用AI服务, model: claude_sonnet4, messages: [{"role":"system","content":"you are GUYUAI , a highly skilled software engineer "},{"role":"user","content":"who are you"}]
2025-11-13 22:20:16.129 ERROR 35324 [-/127.0.0.1/-/66ms POST /api/v1/agent/run] 创建消息失败: Field 'db_id' doesn't have a default value QueryFailedError: Field 'db_id' doesn't have a default value
    at QueryFailedError.TypeORMError [as constructor] (/Users/guyumac/Documents/my-midway/midway-project/src/error/TypeORMError.ts:7:9)
    at new QueryFailedError (/Users/guyumac/Documents/my-midway/midway-project/src/error/QueryFailedError.ts:9:9)
    at Query.onResult (/Users/guyumac/Documents/my-midway/midway-project/src/driver/mysql/MysqlQueryRunner.ts:196:37)
    at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:36:14)
    at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
    at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
    at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
    at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
    at Socket.emit (node:events:524:28)
    at addChunk (node:internal/streams/readable:561:12) {
  query: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, ?, ?, 1, ?, DEFAULT, ?, ?, ?, ?, ?, DEFAULT, ?)',
  parameters: [
    '11F0C09BE01E95908BAF771B70134626',
    'Active',
    2025-11-13T14:20:16.105Z,
    null,
    '11',
    'UserInput',
    '[{"role":"system","content":"you are GUYUAI , a highly skilled software engineer "},{"role":"user","content":"who are you"}]',
    'guyu',
    '{}'
  ],
  driverError: Error: Field 'db_id' doesn't have a default value
      at Packet.asError (/Users/guyumac/node_modules/mysql2/lib/packets/packet.js:740:17)
      at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:29:26)
      at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
      at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
      at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
      at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Socket.Readable.push (node:internal/streams/readable:392:5) {
    code: 'ER_NO_DEFAULT_FOR_FIELD',
    errno: 1364,
    sqlState: 'HY000',
    sqlMessage: "Field 'db_id' doesn't have a default value",
    sql: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, \'11F0C09BE01E95908BAF771B70134626\', \'Active\', 1, \'2025-11-13 22:20:16.105\', DEFAULT, NULL, \'11\', \'UserInput\', \'[{\\"role\\":\\"system\\",\\"content\\":\\"you are GUYUAI , a highly skilled software engineer \\"},{\\"role\\":\\"user\\",\\"content\\":\\"who are you\\"}]\', \'guyu\', DEFAULT, \'{}\')'
  },
  code: 'ER_NO_DEFAULT_FOR_FIELD',
  errno: 1364,
  sqlState: 'HY000',
  sqlMessage: "Field 'db_id' doesn't have a default value",
  sql: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, \'11F0C09BE01E95908BAF771B70134626\', \'Active\', 1, \'2025-11-13 22:20:16.105\', DEFAULT, NULL, \'11\', \'UserInput\', \'[{\\"role\\":\\"system\\",\\"content\\":\\"you are GUYUAI , a highly skilled software engineer \\"},{\\"role\\":\\"user\\",\\"content\\":\\"who are you\\"}]\', \'guyu\', DEFAULT, \'{}\')'
}
2025-11-13 22:20:16.321 ERROR 35324 [-/127.0.0.1/-/258ms POST /api/v1/agent/run] Error: 大模型流式调用失败
    at AiChatService.aiChatWithStream (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AiChatService.ts:59:19)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at AgentService.run (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AgentService.ts:121:9)
    at AgentController.run (/Users/guyumac/Documents/my-midway/midway-project/src/ApiGateway/aiController/AgentController.ts:36:5)
    at AgentController.Clz.<computed> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/service/aspectService.js:92:34)
    at Object.<anonymous> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/common/webGenerator.js:43:26)
    at CorsMiddleware.compatibleMiddleware (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/cross-domain/dist/middleware/cors.js:94:20)
    at xssProtection (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/xssProtection.js:7:5)
    at nosniff (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/nosniff.js:8:5)
    at noopen (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/noopen.js:8:5) {
  headerSent: true
}
2025-11-13 22:20:40.037 INFO 35324 [-/127.0.0.1/-/5ms POST /api/v1/agent/run] 查找会话: 11
2025-11-13 22:20:40.047 WARN 35324 [-/127.0.0.1/-/16ms POST /api/v1/agent/run] 未找到 ID 为 11 的会话
2025-11-13 22:20:40.048 WARN 35324 [-/127.0.0.1/-/17ms POST /api/v1/agent/run] 未找到会话 11，将创建新会话
2025-11-13 22:20:40.048 INFO 35324 [-/127.0.0.1/-/17ms POST /api/v1/agent/run] 创建新会话，workerId: guyu
2025-11-13 22:20:40.057 INFO 35324 [-/127.0.0.1/-/26ms POST /api/v1/agent/run] 创建会话成功: 11
2025-11-13 22:20:40.057 INFO 35324 [-/127.0.0.1/-/26ms POST /api/v1/agent/run] 创建会话成功: 11
2025-11-13 22:20:40.057 INFO 35324 [-/127.0.0.1/-/26ms POST /api/v1/agent/run] 会话模式 - 是否有历史: false, 是否首轮: true
2025-11-13 22:20:40.057 INFO 35324 [-/127.0.0.1/-/26ms POST /api/v1/agent/run] 问题数量: 11
2025-11-13 22:20:40.057 INFO 35324 [-/127.0.0.1/-/26ms POST /api/v1/agent/run] 开始调用AI服务, model: claude_sonnet4, messages: [{"role":"system","content":"you are GUYUAI , a highly skilled software engineer "},{"role":"user","content":"who are you"}]
2025-11-13 22:20:40.062 ERROR 35324 [-/127.0.0.1/-/31ms POST /api/v1/agent/run] 创建消息失败: Field 'db_id' doesn't have a default value QueryFailedError: Field 'db_id' doesn't have a default value
    at QueryFailedError.TypeORMError [as constructor] (/Users/guyumac/Documents/my-midway/midway-project/src/error/TypeORMError.ts:7:9)
    at new QueryFailedError (/Users/guyumac/Documents/my-midway/midway-project/src/error/QueryFailedError.ts:9:9)
    at Query.onResult (/Users/guyumac/Documents/my-midway/midway-project/src/driver/mysql/MysqlQueryRunner.ts:196:37)
    at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:36:14)
    at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
    at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
    at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
    at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
    at Socket.emit (node:events:524:28)
    at addChunk (node:internal/streams/readable:561:12) {
  query: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, ?, ?, 1, ?, DEFAULT, ?, ?, ?, ?, ?, DEFAULT, ?)',
  parameters: [
    '11F0C09BEE655E908BAF771B70134626',
    'Active',
    2025-11-13T14:20:40.057Z,
    null,
    '11',
    'UserInput',
    '[{"role":"system","content":"you are GUYUAI , a highly skilled software engineer "},{"role":"user","content":"who are you"}]',
    'guyu',
    '{}'
  ],
  driverError: Error: Field 'db_id' doesn't have a default value
      at Packet.asError (/Users/guyumac/node_modules/mysql2/lib/packets/packet.js:740:17)
      at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:29:26)
      at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
      at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
      at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
      at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Socket.Readable.push (node:internal/streams/readable:392:5) {
    code: 'ER_NO_DEFAULT_FOR_FIELD',
    errno: 1364,
    sqlState: 'HY000',
    sqlMessage: "Field 'db_id' doesn't have a default value",
    sql: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, \'11F0C09BEE655E908BAF771B70134626\', \'Active\', 1, \'2025-11-13 22:20:40.057\', DEFAULT, NULL, \'11\', \'UserInput\', \'[{\\"role\\":\\"system\\",\\"content\\":\\"you are GUYUAI , a highly skilled software engineer \\"},{\\"role\\":\\"user\\",\\"content\\":\\"who are you\\"}]\', \'guyu\', DEFAULT, \'{}\')'
  },
  code: 'ER_NO_DEFAULT_FOR_FIELD',
  errno: 1364,
  sqlState: 'HY000',
  sqlMessage: "Field 'db_id' doesn't have a default value",
  sql: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, \'11F0C09BEE655E908BAF771B70134626\', \'Active\', 1, \'2025-11-13 22:20:40.057\', DEFAULT, NULL, \'11\', \'UserInput\', \'[{\\"role\\":\\"system\\",\\"content\\":\\"you are GUYUAI , a highly skilled software engineer \\"},{\\"role\\":\\"user\\",\\"content\\":\\"who are you\\"}]\', \'guyu\', DEFAULT, \'{}\')'
}
2025-11-13 22:20:40.252 ERROR 35324 [-/127.0.0.1/-/221ms POST /api/v1/agent/run] Error: 大模型流式调用失败
    at AiChatService.aiChatWithStream (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AiChatService.ts:59:19)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at AgentService.run (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AgentService.ts:121:9)
    at AgentController.run (/Users/guyumac/Documents/my-midway/midway-project/src/ApiGateway/aiController/AgentController.ts:36:5)
    at AgentController.Clz.<computed> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/service/aspectService.js:92:34)
    at Object.<anonymous> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/common/webGenerator.js:43:26)
    at CorsMiddleware.compatibleMiddleware (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/cross-domain/dist/middleware/cors.js:94:20)
    at xssProtection (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/xssProtection.js:7:5)
    at nosniff (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/nosniff.js:8:5)
    at noopen (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/noopen.js:8:5) {
  headerSent: true
}
2025-11-13 22:21:53.558 INFO 37370 [-/127.0.0.1/-/22ms POST /api/v1/agent/run] 查找会话: 11
2025-11-13 22:21:53.567 WARN 37370 [-/127.0.0.1/-/31ms POST /api/v1/agent/run] 未找到 ID 为 11 的会话
2025-11-13 22:21:53.568 WARN 37370 [-/127.0.0.1/-/32ms POST /api/v1/agent/run] 未找到会话 11，将创建新会话
2025-11-13 22:21:53.568 INFO 37370 [-/127.0.0.1/-/32ms POST /api/v1/agent/run] 创建新会话，workerId: guyu
2025-11-13 22:21:53.579 INFO 37370 [-/127.0.0.1/-/43ms POST /api/v1/agent/run] 创建会话成功: 11
2025-11-13 22:21:53.579 INFO 37370 [-/127.0.0.1/-/43ms POST /api/v1/agent/run] 创建会话成功: 11
2025-11-13 22:21:53.579 INFO 37370 [-/127.0.0.1/-/43ms POST /api/v1/agent/run] 会话模式 - 是否有历史: false, 是否首轮: true
2025-11-13 22:21:53.580 INFO 37370 [-/127.0.0.1/-/44ms POST /api/v1/agent/run] 问题数量: 11
2025-11-13 22:21:53.580 INFO 37370 [-/127.0.0.1/-/44ms POST /api/v1/agent/run] 开始调用AI服务, model: claude_sonnet4, messages: [{"role":"system","content":"you are GUYUAI , a highly skilled software engineer "},{"role":"user","content":"who are you"}]
2025-11-13 22:21:53.608 ERROR 37370 [-/127.0.0.1/-/72ms POST /api/v1/agent/run] 创建消息失败: Field 'db_id' doesn't have a default value QueryFailedError: Field 'db_id' doesn't have a default value
    at QueryFailedError.TypeORMError [as constructor] (/Users/guyumac/Documents/my-midway/midway-project/src/error/TypeORMError.ts:7:9)
    at new QueryFailedError (/Users/guyumac/Documents/my-midway/midway-project/src/error/QueryFailedError.ts:9:9)
    at Query.onResult (/Users/guyumac/Documents/my-midway/midway-project/src/driver/mysql/MysqlQueryRunner.ts:196:37)
    at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:36:14)
    at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
    at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
    at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
    at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
    at Socket.emit (node:events:524:28)
    at addChunk (node:internal/streams/readable:561:12) {
  query: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, ?, ?, 1, ?, DEFAULT, ?, ?, ?, ?, ?, DEFAULT, ?)',
  parameters: [
    '11F0C09C1A3816C082153B26770CF8C2',
    'Active',
    2025-11-13T14:21:53.580Z,
    null,
    '11',
    'UserInput',
    '[{"role":"system","content":"you are GUYUAI , a highly skilled software engineer "},{"role":"user","content":"who are you"}]',
    'guyu',
    '{}'
  ],
  driverError: Error: Field 'db_id' doesn't have a default value
      at Packet.asError (/Users/guyumac/node_modules/mysql2/lib/packets/packet.js:740:17)
      at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:29:26)
      at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
      at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
      at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
      at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Socket.Readable.push (node:internal/streams/readable:392:5) {
    code: 'ER_NO_DEFAULT_FOR_FIELD',
    errno: 1364,
    sqlState: 'HY000',
    sqlMessage: "Field 'db_id' doesn't have a default value",
    sql: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, \'11F0C09C1A3816C082153B26770CF8C2\', \'Active\', 1, \'2025-11-13 22:21:53.580\', DEFAULT, NULL, \'11\', \'UserInput\', \'[{\\"role\\":\\"system\\",\\"content\\":\\"you are GUYUAI , a highly skilled software engineer \\"},{\\"role\\":\\"user\\",\\"content\\":\\"who are you\\"}]\', \'guyu\', DEFAULT, \'{}\')'
  },
  code: 'ER_NO_DEFAULT_FOR_FIELD',
  errno: 1364,
  sqlState: 'HY000',
  sqlMessage: "Field 'db_id' doesn't have a default value",
  sql: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, \'11F0C09C1A3816C082153B26770CF8C2\', \'Active\', 1, \'2025-11-13 22:21:53.580\', DEFAULT, NULL, \'11\', \'UserInput\', \'[{\\"role\\":\\"system\\",\\"content\\":\\"you are GUYUAI , a highly skilled software engineer \\"},{\\"role\\":\\"user\\",\\"content\\":\\"who are you\\"}]\', \'guyu\', DEFAULT, \'{}\')'
}
2025-11-13 22:21:53.800 ERROR 37370 [-/127.0.0.1/-/264ms POST /api/v1/agent/run] Error: 大模型流式调用失败
    at AiChatService.aiChatWithStream (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AiChatService.ts:61:19)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at AgentService.run (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AgentService.ts:121:9)
    at AgentController.run (/Users/guyumac/Documents/my-midway/midway-project/src/ApiGateway/aiController/AgentController.ts:36:5)
    at AgentController.Clz.<computed> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/service/aspectService.js:92:34)
    at Object.<anonymous> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/common/webGenerator.js:43:26)
    at CorsMiddleware.compatibleMiddleware (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/cross-domain/dist/middleware/cors.js:94:20)
    at xssProtection (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/xssProtection.js:7:5)
    at nosniff (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/nosniff.js:8:5)
    at noopen (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/noopen.js:8:5) {
  headerSent: true
}
2025-11-13 22:22:34.217 INFO 37982 [-/127.0.0.1/-/22ms POST /api/v1/agent/run] 查找会话: 11
2025-11-13 22:22:34.238 WARN 37982 [-/127.0.0.1/-/43ms POST /api/v1/agent/run] 未找到 ID 为 11 的会话
2025-11-13 22:22:34.238 WARN 37982 [-/127.0.0.1/-/44ms POST /api/v1/agent/run] 未找到会话 11，将创建新会话
2025-11-13 22:22:34.238 INFO 37982 [-/127.0.0.1/-/44ms POST /api/v1/agent/run] 创建新会话，workerId: guyu
2025-11-13 22:22:34.248 INFO 37982 [-/127.0.0.1/-/54ms POST /api/v1/agent/run] 创建会话成功: 11
2025-11-13 22:22:34.248 INFO 37982 [-/127.0.0.1/-/54ms POST /api/v1/agent/run] 创建会话成功: 11
2025-11-13 22:22:34.248 INFO 37982 [-/127.0.0.1/-/54ms POST /api/v1/agent/run] 会话模式 - 是否有历史: false, 是否首轮: true
2025-11-13 22:22:34.248 INFO 37982 [-/127.0.0.1/-/54ms POST /api/v1/agent/run] 问题数量: 11
2025-11-13 22:22:34.248 INFO 37982 [-/127.0.0.1/-/54ms POST /api/v1/agent/run] 开始调用AI服务, model: claude_sonnet4, messages: [{"role":"system","content":"you are GUYUAI , a highly skilled software engineer "},{"role":"user","content":"who are you"}]
2025-11-13 22:22:34.272 ERROR 37982 [-/127.0.0.1/-/78ms POST /api/v1/agent/run] 创建消息失败: Field 'db_id' doesn't have a default value QueryFailedError: Field 'db_id' doesn't have a default value
    at QueryFailedError.TypeORMError [as constructor] (/Users/guyumac/Documents/my-midway/midway-project/src/error/TypeORMError.ts:7:9)
    at new QueryFailedError (/Users/guyumac/Documents/my-midway/midway-project/src/error/QueryFailedError.ts:9:9)
    at Query.onResult (/Users/guyumac/Documents/my-midway/midway-project/src/driver/mysql/MysqlQueryRunner.ts:196:37)
    at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:36:14)
    at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
    at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
    at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
    at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
    at Socket.emit (node:events:524:28)
    at addChunk (node:internal/streams/readable:561:12) {
  query: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, ?, ?, 1, ?, DEFAULT, ?, ?, ?, ?, ?, DEFAULT, ?)',
  parameters: [
    '11F0C09C32758880B5A2A33795830524',
    'Active',
    2025-11-13T14:22:34.248Z,
    null,
    '11',
    'UserInput',
    '[{"role":"system","content":"you are GUYUAI , a highly skilled software engineer "},{"role":"user","content":"who are you"}]',
    'guyu',
    '{}'
  ],
  driverError: Error: Field 'db_id' doesn't have a default value
      at Packet.asError (/Users/guyumac/node_modules/mysql2/lib/packets/packet.js:740:17)
      at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:29:26)
      at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
      at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
      at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
      at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Socket.Readable.push (node:internal/streams/readable:392:5) {
    code: 'ER_NO_DEFAULT_FOR_FIELD',
    errno: 1364,
    sqlState: 'HY000',
    sqlMessage: "Field 'db_id' doesn't have a default value",
    sql: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, \'11F0C09C32758880B5A2A33795830524\', \'Active\', 1, \'2025-11-13 22:22:34.248\', DEFAULT, NULL, \'11\', \'UserInput\', \'[{\\"role\\":\\"system\\",\\"content\\":\\"you are GUYUAI , a highly skilled software engineer \\"},{\\"role\\":\\"user\\",\\"content\\":\\"who are you\\"}]\', \'guyu\', DEFAULT, \'{}\')'
  },
  code: 'ER_NO_DEFAULT_FOR_FIELD',
  errno: 1364,
  sqlState: 'HY000',
  sqlMessage: "Field 'db_id' doesn't have a default value",
  sql: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, \'11F0C09C32758880B5A2A33795830524\', \'Active\', 1, \'2025-11-13 22:22:34.248\', DEFAULT, NULL, \'11\', \'UserInput\', \'[{\\"role\\":\\"system\\",\\"content\\":\\"you are GUYUAI , a highly skilled software engineer \\"},{\\"role\\":\\"user\\",\\"content\\":\\"who are you\\"}]\', \'guyu\', DEFAULT, \'{}\')'
}
2025-11-13 22:22:34.428 ERROR 37982 [-/127.0.0.1/-/234ms POST /api/v1/agent/run] Error: 大模型流式调用失败
    at AiChatService.aiChatWithStream (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AiChatService.ts:61:19)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at AgentService.run (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AgentService.ts:121:9)
    at AgentController.run (/Users/guyumac/Documents/my-midway/midway-project/src/ApiGateway/aiController/AgentController.ts:36:5)
    at AgentController.Clz.<computed> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/service/aspectService.js:92:34)
    at Object.<anonymous> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/common/webGenerator.js:43:26)
    at CorsMiddleware.compatibleMiddleware (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/cross-domain/dist/middleware/cors.js:94:20)
    at xssProtection (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/xssProtection.js:7:5)
    at nosniff (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/nosniff.js:8:5)
    at noopen (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/noopen.js:8:5) {
  headerSent: true
}
2025-11-13 22:23:14.889 INFO 38730 [-/127.0.0.1/-/16ms POST /api/v1/agent/run] 查找会话: 11
2025-11-13 22:23:14.904 INFO 38730 [-/127.0.0.1/-/31ms POST /api/v1/agent/run] 查询会话成功: 11
2025-11-13 22:23:14.904 INFO 38730 [-/127.0.0.1/-/31ms POST /api/v1/agent/run] 找到历史会话: 11
2025-11-13 22:23:14.905 INFO 38730 [-/127.0.0.1/-/32ms POST /api/v1/agent/run] 会话模式 - 是否有历史: true, 是否首轮: false
2025-11-13 22:23:14.905 INFO 38730 [-/127.0.0.1/-/32ms POST /api/v1/agent/run] 问题数量: 11
2025-11-13 22:23:14.909 INFO 38730 [-/127.0.0.1/-/36ms POST /api/v1/agent/run] 查询 sessionId 为 11 的消息，共 0 条
2025-11-13 22:23:14.909 INFO 38730 [-/127.0.0.1/-/36ms POST /api/v1/agent/run] 开始调用AI服务, model: claude_sonnet4, messages: [{"role":"system","content":"you are GUYUAI , a highly skilled software engineer "},{"role":"user","content":"who are you"}]
2025-11-13 22:23:14.939 ERROR 38730 [-/127.0.0.1/-/66ms POST /api/v1/agent/run] 创建消息失败: Field 'db_id' doesn't have a default value QueryFailedError: Field 'db_id' doesn't have a default value
    at QueryFailedError.TypeORMError [as constructor] (/Users/guyumac/Documents/my-midway/midway-project/src/error/TypeORMError.ts:7:9)
    at new QueryFailedError (/Users/guyumac/Documents/my-midway/midway-project/src/error/QueryFailedError.ts:9:9)
    at Query.onResult (/Users/guyumac/Documents/my-midway/midway-project/src/driver/mysql/MysqlQueryRunner.ts:196:37)
    at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:36:14)
    at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
    at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
    at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
    at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
    at Socket.emit (node:events:524:28)
    at addChunk (node:internal/streams/readable:561:12) {
  query: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, ?, ?, 1, ?, DEFAULT, ?, ?, ?, ?, ?, DEFAULT, ?)',
  parameters: [
    '11F0C09C4AB1E8D096FECB7FEF1F4B2A',
    'Active',
    2025-11-13T14:23:14.909Z,
    null,
    '11',
    'UserInput',
    '[{"role":"system","content":"you are GUYUAI , a highly skilled software engineer "},{"role":"user","content":"who are you"}]',
    'guyu',
    '{}'
  ],
  driverError: Error: Field 'db_id' doesn't have a default value
      at Packet.asError (/Users/guyumac/node_modules/mysql2/lib/packets/packet.js:740:17)
      at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:29:26)
      at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
      at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
      at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
      at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Socket.Readable.push (node:internal/streams/readable:392:5) {
    code: 'ER_NO_DEFAULT_FOR_FIELD',
    errno: 1364,
    sqlState: 'HY000',
    sqlMessage: "Field 'db_id' doesn't have a default value",
    sql: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, \'11F0C09C4AB1E8D096FECB7FEF1F4B2A\', \'Active\', 1, \'2025-11-13 22:23:14.909\', DEFAULT, NULL, \'11\', \'UserInput\', \'[{\\"role\\":\\"system\\",\\"content\\":\\"you are GUYUAI , a highly skilled software engineer \\"},{\\"role\\":\\"user\\",\\"content\\":\\"who are you\\"}]\', \'guyu\', DEFAULT, \'{}\')'
  },
  code: 'ER_NO_DEFAULT_FOR_FIELD',
  errno: 1364,
  sqlState: 'HY000',
  sqlMessage: "Field 'db_id' doesn't have a default value",
  sql: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, \'11F0C09C4AB1E8D096FECB7FEF1F4B2A\', \'Active\', 1, \'2025-11-13 22:23:14.909\', DEFAULT, NULL, \'11\', \'UserInput\', \'[{\\"role\\":\\"system\\",\\"content\\":\\"you are GUYUAI , a highly skilled software engineer \\"},{\\"role\\":\\"user\\",\\"content\\":\\"who are you\\"}]\', \'guyu\', DEFAULT, \'{}\')'
}
2025-11-13 22:23:15.113 ERROR 38730 [-/127.0.0.1/-/240ms POST /api/v1/agent/run] Error: 大模型流式调用失败:Error: 失败原因:AxiosError: Request failed with status code 404
    at AiChatService.aiChatWithStream (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AiChatService.ts:61:19)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at AgentService.run (/Users/guyumac/Documents/my-midway/midway-project/src/BussinessLayer/Agent/Application/Service/AgentService.ts:121:9)
    at AgentController.run (/Users/guyumac/Documents/my-midway/midway-project/src/ApiGateway/aiController/AgentController.ts:36:5)
    at AgentController.Clz.<computed> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/service/aspectService.js:92:34)
    at Object.<anonymous> (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/core/dist/common/webGenerator.js:43:26)
    at CorsMiddleware.compatibleMiddleware (/Users/guyumac/Documents/my-midway/midway-project/node_modules/@midwayjs/cross-domain/dist/middleware/cors.js:94:20)
    at xssProtection (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/xssProtection.js:7:5)
    at nosniff (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/nosniff.js:8:5)
    at noopen (/Users/guyumac/Documents/my-midway/midway-project/node_modules/egg-security/lib/middlewares/noopen.js:8:5) {
  headerSent: true
}
2025-11-13 22:24:56.589 INFO 40244 [-/127.0.0.1/-/27ms POST /api/v1/agent/run] 查找会话: 11
2025-11-13 22:24:56.601 WARN 40244 [-/127.0.0.1/-/39ms POST /api/v1/agent/run] 未找到 ID 为 11 的会话
2025-11-13 22:24:56.601 WARN 40244 [-/127.0.0.1/-/39ms POST /api/v1/agent/run] 未找到会话 11，将创建新会话
2025-11-13 22:24:56.601 INFO 40244 [-/127.0.0.1/-/39ms POST /api/v1/agent/run] 创建新会话，workerId: guyu
2025-11-13 22:24:56.611 INFO 40244 [-/127.0.0.1/-/49ms POST /api/v1/agent/run] 创建会话成功: 11
2025-11-13 22:24:56.611 INFO 40244 [-/127.0.0.1/-/49ms POST /api/v1/agent/run] 创建会话成功: 11
2025-11-13 22:24:56.611 INFO 40244 [-/127.0.0.1/-/49ms POST /api/v1/agent/run] 会话模式 - 是否有历史: false, 是否首轮: true
2025-11-13 22:24:56.611 INFO 40244 [-/127.0.0.1/-/49ms POST /api/v1/agent/run] 问题数量: 11
2025-11-13 22:24:56.612 INFO 40244 [-/127.0.0.1/-/50ms POST /api/v1/agent/run] 开始调用AI服务, model: claude_sonnet4, messages: [{"role":"system","content":"you are GUYUAI , a highly skilled software engineer "},{"role":"user","content":"who are you"}]
2025-11-13 22:24:56.638 ERROR 40244 [-/127.0.0.1/-/76ms POST /api/v1/agent/run] 创建消息失败: Field 'db_id' doesn't have a default value QueryFailedError: Field 'db_id' doesn't have a default value
    at QueryFailedError.TypeORMError [as constructor] (/Users/guyumac/Documents/my-midway/midway-project/src/error/TypeORMError.ts:7:9)
    at new QueryFailedError (/Users/guyumac/Documents/my-midway/midway-project/src/error/QueryFailedError.ts:9:9)
    at Query.onResult (/Users/guyumac/Documents/my-midway/midway-project/src/driver/mysql/MysqlQueryRunner.ts:196:37)
    at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:36:14)
    at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
    at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
    at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
    at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
    at Socket.emit (node:events:524:28)
    at addChunk (node:internal/streams/readable:561:12) {
  query: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, ?, ?, 1, ?, DEFAULT, ?, ?, ?, ?, ?, DEFAULT, ?)',
  parameters: [
    '11F0C09C87506730951E81E4FCAF3A2C',
    'Active',
    2025-11-13T14:24:56.611Z,
    null,
    '11',
    'UserInput',
    '[{"role":"system","content":"you are GUYUAI , a highly skilled software engineer "},{"role":"user","content":"who are you"}]',
    'guyu',
    '{}'
  ],
  driverError: Error: Field 'db_id' doesn't have a default value
      at Packet.asError (/Users/guyumac/node_modules/mysql2/lib/packets/packet.js:740:17)
      at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:29:26)
      at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
      at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
      at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
      at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Socket.Readable.push (node:internal/streams/readable:392:5) {
    code: 'ER_NO_DEFAULT_FOR_FIELD',
    errno: 1364,
    sqlState: 'HY000',
    sqlMessage: "Field 'db_id' doesn't have a default value",
    sql: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, \'11F0C09C87506730951E81E4FCAF3A2C\', \'Active\', 1, \'2025-11-13 22:24:56.611\', DEFAULT, NULL, \'11\', \'UserInput\', \'[{\\"role\\":\\"system\\",\\"content\\":\\"you are GUYUAI , a highly skilled software engineer \\"},{\\"role\\":\\"user\\",\\"content\\":\\"who are you\\"}]\', \'guyu\', DEFAULT, \'{}\')'
  },
  code: 'ER_NO_DEFAULT_FOR_FIELD',
  errno: 1364,
  sqlState: 'HY000',
  sqlMessage: "Field 'db_id' doesn't have a default value",
  sql: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, \'11F0C09C87506730951E81E4FCAF3A2C\', \'Active\', 1, \'2025-11-13 22:24:56.611\', DEFAULT, NULL, \'11\', \'UserInput\', \'[{\\"role\\":\\"system\\",\\"content\\":\\"you are GUYUAI , a highly skilled software engineer \\"},{\\"role\\":\\"user\\",\\"content\\":\\"who are you\\"}]\', \'guyu\', DEFAULT, \'{}\')'
}
2025-11-13 22:28:04.691 INFO 43568 [-/127.0.0.1/-/18ms POST /api/v1/agent/run] 查找会话: 11
2025-11-13 22:28:04.707 WARN 43568 [-/127.0.0.1/-/34ms POST /api/v1/agent/run] 未找到 ID 为 11 的会话
2025-11-13 22:28:04.707 WARN 43568 [-/127.0.0.1/-/34ms POST /api/v1/agent/run] 未找到会话 11，将创建新会话
2025-11-13 22:28:04.707 INFO 43568 [-/127.0.0.1/-/34ms POST /api/v1/agent/run] 创建新会话，workerId: guyu
2025-11-13 22:28:04.717 INFO 43568 [-/127.0.0.1/-/44ms POST /api/v1/agent/run] 创建会话成功: 11
2025-11-13 22:28:04.718 INFO 43568 [-/127.0.0.1/-/45ms POST /api/v1/agent/run] 创建会话成功: 11
2025-11-13 22:28:04.718 INFO 43568 [-/127.0.0.1/-/45ms POST /api/v1/agent/run] 会话模式 - 是否有历史: false, 是否首轮: true
2025-11-13 22:28:04.718 INFO 43568 [-/127.0.0.1/-/45ms POST /api/v1/agent/run] 问题数量: 11
2025-11-13 22:28:04.718 INFO 43568 [-/127.0.0.1/-/45ms POST /api/v1/agent/run] 开始调用AI服务, model: claude_sonnet4, messages: [{"role":"system","content":"you are GUYUAI , a highly skilled software engineer "},{"role":"user","content":"who are you"}]
2025-11-13 22:28:04.742 ERROR 43568 [-/127.0.0.1/-/69ms POST /api/v1/agent/run] 创建消息失败: Field 'db_id' doesn't have a default value QueryFailedError: Field 'db_id' doesn't have a default value
    at QueryFailedError.TypeORMError [as constructor] (/Users/guyumac/Documents/my-midway/midway-project/src/error/TypeORMError.ts:7:9)
    at new QueryFailedError (/Users/guyumac/Documents/my-midway/midway-project/src/error/QueryFailedError.ts:9:9)
    at Query.onResult (/Users/guyumac/Documents/my-midway/midway-project/src/driver/mysql/MysqlQueryRunner.ts:196:37)
    at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:36:14)
    at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
    at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
    at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
    at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
    at Socket.emit (node:events:524:28)
    at addChunk (node:internal/streams/readable:561:12) {
  query: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, ?, ?, 1, ?, DEFAULT, ?, ?, ?, ?, ?, DEFAULT, ?)',
  parameters: [
    '11F0C09CF76F40E08F6B9F301BD3839B',
    'Active',
    2025-11-13T14:28:04.718Z,
    null,
    '11',
    'UserInput',
    '[{"role":"system","content":"you are GUYUAI , a highly skilled software engineer "},{"role":"user","content":"who are you"}]',
    'guyu',
    '{}'
  ],
  driverError: Error: Field 'db_id' doesn't have a default value
      at Packet.asError (/Users/guyumac/node_modules/mysql2/lib/packets/packet.js:740:17)
      at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:29:26)
      at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
      at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
      at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
      at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Socket.Readable.push (node:internal/streams/readable:392:5) {
    code: 'ER_NO_DEFAULT_FOR_FIELD',
    errno: 1364,
    sqlState: 'HY000',
    sqlMessage: "Field 'db_id' doesn't have a default value",
    sql: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, \'11F0C09CF76F40E08F6B9F301BD3839B\', \'Active\', 1, \'2025-11-13 22:28:04.718\', DEFAULT, NULL, \'11\', \'UserInput\', \'[{\\"role\\":\\"system\\",\\"content\\":\\"you are GUYUAI , a highly skilled software engineer \\"},{\\"role\\":\\"user\\",\\"content\\":\\"who are you\\"}]\', \'guyu\', DEFAULT, \'{}\')'
  },
  code: 'ER_NO_DEFAULT_FOR_FIELD',
  errno: 1364,
  sqlState: 'HY000',
  sqlMessage: "Field 'db_id' doesn't have a default value",
  sql: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, \'11F0C09CF76F40E08F6B9F301BD3839B\', \'Active\', 1, \'2025-11-13 22:28:04.718\', DEFAULT, NULL, \'11\', \'UserInput\', \'[{\\"role\\":\\"system\\",\\"content\\":\\"you are GUYUAI , a highly skilled software engineer \\"},{\\"role\\":\\"user\\",\\"content\\":\\"who are you\\"}]\', \'guyu\', DEFAULT, \'{}\')'
}
2025-11-13 22:30:15.023 INFO 45809 [-/127.0.0.1/-/18ms POST /api/v1/agent/run] 查找会话: 11
2025-11-13 22:30:15.039 WARN 45809 [-/127.0.0.1/-/34ms POST /api/v1/agent/run] 未找到 ID 为 11 的会话
2025-11-13 22:30:15.039 WARN 45809 [-/127.0.0.1/-/34ms POST /api/v1/agent/run] 未找到会话 11，将创建新会话
2025-11-13 22:30:15.039 INFO 45809 [-/127.0.0.1/-/34ms POST /api/v1/agent/run] 创建新会话，workerId: guyu
2025-11-13 22:30:15.047 INFO 45809 [-/127.0.0.1/-/42ms POST /api/v1/agent/run] 创建会话成功: 11
2025-11-13 22:30:15.047 INFO 45809 [-/127.0.0.1/-/42ms POST /api/v1/agent/run] 创建会话成功: 11
2025-11-13 22:30:15.047 INFO 45809 [-/127.0.0.1/-/42ms POST /api/v1/agent/run] 会话模式 - 是否有历史: false, 是否首轮: true
2025-11-13 22:30:15.047 INFO 45809 [-/127.0.0.1/-/42ms POST /api/v1/agent/run] 问题数量: 11
2025-11-13 22:30:15.047 INFO 45809 [-/127.0.0.1/-/42ms POST /api/v1/agent/run] 开始调用AI服务, model: claude_sonnet4, messages: [{"role":"system","content":"you are GUYUAI , a highly skilled software engineer "},{"role":"user","content":"who are you"}]
2025-11-13 22:30:15.080 ERROR 45809 [-/127.0.0.1/-/75ms POST /api/v1/agent/run] 创建消息失败: Field 'db_id' doesn't have a default value QueryFailedError: Field 'db_id' doesn't have a default value
    at QueryFailedError.TypeORMError [as constructor] (/Users/guyumac/Documents/my-midway/midway-project/src/error/TypeORMError.ts:7:9)
    at new QueryFailedError (/Users/guyumac/Documents/my-midway/midway-project/src/error/QueryFailedError.ts:9:9)
    at Query.onResult (/Users/guyumac/Documents/my-midway/midway-project/src/driver/mysql/MysqlQueryRunner.ts:196:37)
    at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:36:14)
    at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
    at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
    at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
    at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
    at Socket.emit (node:events:524:28)
    at addChunk (node:internal/streams/readable:561:12) {
  query: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, ?, ?, 1, ?, DEFAULT, ?, ?, ?, ?, ?, DEFAULT, ?)',
  parameters: [
    '11F0C09D451DE170A9952DEBB3388498',
    'Active',
    2025-11-13T14:30:15.047Z,
    null,
    '11',
    'UserInput',
    '[{"role":"system","content":"you are GUYUAI , a highly skilled software engineer "},{"role":"user","content":"who are you"}]',
    'guyu',
    '{}'
  ],
  driverError: Error: Field 'db_id' doesn't have a default value
      at Packet.asError (/Users/guyumac/node_modules/mysql2/lib/packets/packet.js:740:17)
      at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:29:26)
      at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
      at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
      at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
      at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Socket.Readable.push (node:internal/streams/readable:392:5) {
    code: 'ER_NO_DEFAULT_FOR_FIELD',
    errno: 1364,
    sqlState: 'HY000',
    sqlMessage: "Field 'db_id' doesn't have a default value",
    sql: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, \'11F0C09D451DE170A9952DEBB3388498\', \'Active\', 1, \'2025-11-13 22:30:15.047\', DEFAULT, NULL, \'11\', \'UserInput\', \'[{\\"role\\":\\"system\\",\\"content\\":\\"you are GUYUAI , a highly skilled software engineer \\"},{\\"role\\":\\"user\\",\\"content\\":\\"who are you\\"}]\', \'guyu\', DEFAULT, \'{}\')'
  },
  code: 'ER_NO_DEFAULT_FOR_FIELD',
  errno: 1364,
  sqlState: 'HY000',
  sqlMessage: "Field 'db_id' doesn't have a default value",
  sql: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, \'11F0C09D451DE170A9952DEBB3388498\', \'Active\', 1, \'2025-11-13 22:30:15.047\', DEFAULT, NULL, \'11\', \'UserInput\', \'[{\\"role\\":\\"system\\",\\"content\\":\\"you are GUYUAI , a highly skilled software engineer \\"},{\\"role\\":\\"user\\",\\"content\\":\\"who are you\\"}]\', \'guyu\', DEFAULT, \'{}\')'
}
2025-11-13 22:34:58.699 INFO 49685 [-/127.0.0.1/-/18ms POST /api/v1/agent/run] 查找会话: 11
2025-11-13 22:34:58.706 WARN 49685 [-/127.0.0.1/-/25ms POST /api/v1/agent/run] 未找到 ID 为 11 的会话
2025-11-13 22:34:58.706 WARN 49685 [-/127.0.0.1/-/25ms POST /api/v1/agent/run] 未找到会话 11，将创建新会话
2025-11-13 22:34:58.706 INFO 49685 [-/127.0.0.1/-/25ms POST /api/v1/agent/run] 创建新会话，workerId: guyu
2025-11-13 22:34:58.713 INFO 49685 [-/127.0.0.1/-/32ms POST /api/v1/agent/run] 创建会话成功: 11
2025-11-13 22:34:58.713 INFO 49685 [-/127.0.0.1/-/32ms POST /api/v1/agent/run] 创建会话成功: 11
2025-11-13 22:34:58.714 INFO 49685 [-/127.0.0.1/-/32ms POST /api/v1/agent/run] 会话模式 - 是否有历史: false, 是否首轮: true
2025-11-13 22:34:58.714 INFO 49685 [-/127.0.0.1/-/33ms POST /api/v1/agent/run] 问题数量: 8
2025-11-13 22:34:58.714 INFO 49685 [-/127.0.0.1/-/33ms POST /api/v1/agent/run] 开始调用AI服务, model: claude_sonnet4, messages: [{"role":"system","content":"你的名字叫小Q，你是一位医疗专家"},{"role":"user","content":"你可以为我做什么"}]
2025-11-13 22:34:58.743 ERROR 49685 [-/127.0.0.1/-/62ms POST /api/v1/agent/run] 创建消息失败: Field 'db_id' doesn't have a default value QueryFailedError: Field 'db_id' doesn't have a default value
    at QueryFailedError.TypeORMError [as constructor] (/Users/guyumac/Documents/my-midway/midway-project/src/error/TypeORMError.ts:7:9)
    at new QueryFailedError (/Users/guyumac/Documents/my-midway/midway-project/src/error/QueryFailedError.ts:9:9)
    at Query.onResult (/Users/guyumac/Documents/my-midway/midway-project/src/driver/mysql/MysqlQueryRunner.ts:196:37)
    at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:36:14)
    at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
    at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
    at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
    at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
    at Socket.emit (node:events:524:28)
    at addChunk (node:internal/streams/readable:561:12) {
  query: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, ?, ?, 1, ?, DEFAULT, ?, ?, ?, ?, ?, DEFAULT, ?)',
  parameters: [
    '11F0C09DEE3207A09A680176E0CF42CC',
    'Active',
    2025-11-13T14:34:58.714Z,
    null,
    '11',
    'UserInput',
    '[{"role":"system","content":"你的名字叫小Q，你是一位医疗专家"},{"role":"user","content":"你可以为我做什么"}]',
    'guyu',
    '{}'
  ],
  driverError: Error: Field 'db_id' doesn't have a default value
      at Packet.asError (/Users/guyumac/node_modules/mysql2/lib/packets/packet.js:740:17)
      at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:29:26)
      at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
      at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
      at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
      at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Socket.Readable.push (node:internal/streams/readable:392:5) {
    code: 'ER_NO_DEFAULT_FOR_FIELD',
    errno: 1364,
    sqlState: 'HY000',
    sqlMessage: "Field 'db_id' doesn't have a default value",
    sql: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, \'11F0C09DEE3207A09A680176E0CF42CC\', \'Active\', 1, \'2025-11-13 22:34:58.714\', DEFAULT, NULL, \'11\', \'UserInput\', \'[{\\"role\\":\\"system\\",\\"content\\":\\"你的名字叫小Q，你是一位医疗专家\\"},{\\"role\\":\\"user\\",\\"content\\":\\"你可以为我做什么\\"}]\', \'guyu\', DEFAULT, \'{}\')'
  },
  code: 'ER_NO_DEFAULT_FOR_FIELD',
  errno: 1364,
  sqlState: 'HY000',
  sqlMessage: "Field 'db_id' doesn't have a default value",
  sql: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, \'11F0C09DEE3207A09A680176E0CF42CC\', \'Active\', 1, \'2025-11-13 22:34:58.714\', DEFAULT, NULL, \'11\', \'UserInput\', \'[{\\"role\\":\\"system\\",\\"content\\":\\"你的名字叫小Q，你是一位医疗专家\\"},{\\"role\\":\\"user\\",\\"content\\":\\"你可以为我做什么\\"}]\', \'guyu\', DEFAULT, \'{}\')'
}
2025-11-13 22:35:43.118 INFO 49685 [-/127.0.0.1/-/3ms POST /api/v1/agent/run] 查找会话: 11
2025-11-13 22:35:43.123 WARN 49685 [-/127.0.0.1/-/8ms POST /api/v1/agent/run] 未找到 ID 为 11 的会话
2025-11-13 22:35:43.123 WARN 49685 [-/127.0.0.1/-/8ms POST /api/v1/agent/run] 未找到会话 11，将创建新会话
2025-11-13 22:35:43.123 INFO 49685 [-/127.0.0.1/-/8ms POST /api/v1/agent/run] 创建新会话，workerId: guyu
2025-11-13 22:35:43.133 INFO 49685 [-/127.0.0.1/-/18ms POST /api/v1/agent/run] 创建会话成功: 11
2025-11-13 22:35:43.133 INFO 49685 [-/127.0.0.1/-/18ms POST /api/v1/agent/run] 创建会话成功: 11
2025-11-13 22:35:43.133 INFO 49685 [-/127.0.0.1/-/18ms POST /api/v1/agent/run] 会话模式 - 是否有历史: false, 是否首轮: true
2025-11-13 22:35:43.133 INFO 49685 [-/127.0.0.1/-/18ms POST /api/v1/agent/run] 问题数量: 8
2025-11-13 22:35:43.134 INFO 49685 [-/127.0.0.1/-/19ms POST /api/v1/agent/run] 开始调用AI服务, model: claude_sonnet4, messages: [{"role":"system","content":"你的名字叫小Q，你是一位医疗专家"},{"role":"user","content":"你可以为我做什么"}]
2025-11-13 22:35:43.145 ERROR 49685 [-/127.0.0.1/-/30ms POST /api/v1/agent/run] 创建消息失败: Field 'db_id' doesn't have a default value QueryFailedError: Field 'db_id' doesn't have a default value
    at QueryFailedError.TypeORMError [as constructor] (/Users/guyumac/Documents/my-midway/midway-project/src/error/TypeORMError.ts:7:9)
    at new QueryFailedError (/Users/guyumac/Documents/my-midway/midway-project/src/error/QueryFailedError.ts:9:9)
    at Query.onResult (/Users/guyumac/Documents/my-midway/midway-project/src/driver/mysql/MysqlQueryRunner.ts:196:37)
    at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:36:14)
    at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
    at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
    at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
    at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
    at Socket.emit (node:events:524:28)
    at addChunk (node:internal/streams/readable:561:12) {
  query: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, ?, ?, 1, ?, DEFAULT, ?, ?, ?, ?, ?, DEFAULT, ?)',
  parameters: [
    '11F0C09E08ABFBE09A680176E0CF42CC',
    'Active',
    2025-11-13T14:35:43.134Z,
    null,
    '11',
    'UserInput',
    '[{"role":"system","content":"你的名字叫小Q，你是一位医疗专家"},{"role":"user","content":"你可以为我做什么"}]',
    'guyu',
    '{}'
  ],
  driverError: Error: Field 'db_id' doesn't have a default value
      at Packet.asError (/Users/guyumac/node_modules/mysql2/lib/packets/packet.js:740:17)
      at Query.execute (/Users/guyumac/node_modules/mysql2/lib/commands/command.js:29:26)
      at PoolConnection.handlePacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:477:34)
      at PacketParser.onPacket (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:93:12)
      at PacketParser.executeStart (/Users/guyumac/node_modules/mysql2/lib/packet_parser.js:75:16)
      at Socket.<anonymous> (/Users/guyumac/node_modules/mysql2/lib/base/connection.js:100:25)
      at Socket.emit (node:events:524:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Socket.Readable.push (node:internal/streams/readable:392:5) {
    code: 'ER_NO_DEFAULT_FOR_FIELD',
    errno: 1364,
    sqlState: 'HY000',
    sqlMessage: "Field 'db_id' doesn't have a default value",
    sql: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, \'11F0C09E08ABFBE09A680176E0CF42CC\', \'Active\', 1, \'2025-11-13 22:35:43.134\', DEFAULT, NULL, \'11\', \'UserInput\', \'[{\\"role\\":\\"system\\",\\"content\\":\\"你的名字叫小Q，你是一位医疗专家\\"},{\\"role\\":\\"user\\",\\"content\\":\\"你可以为我做什么\\"}]\', \'guyu\', DEFAULT, \'{}\')'
  },
  code: 'ER_NO_DEFAULT_FOR_FIELD',
  errno: 1364,
  sqlState: 'HY000',
  sqlMessage: "Field 'db_id' doesn't have a default value",
  sql: 'INSERT INTO `ai_message`(`db_id`, `id`, `status`, `version`, `create_date`, `update_date`, `removed_date`, `session_id`, `from_type`, `message_content`, `worker_id`, `ext`, `llm_config`) VALUES (DEFAULT, \'11F0C09E08ABFBE09A680176E0CF42CC\', \'Active\', 1, \'2025-11-13 22:35:43.134\', DEFAULT, NULL, \'11\', \'UserInput\', \'[{\\"role\\":\\"system\\",\\"content\\":\\"你的名字叫小Q，你是一位医疗专家\\"},{\\"role\\":\\"user\\",\\"content\\":\\"你可以为我做什么\\"}]\', \'guyu\', DEFAULT, \'{}\')'
}
